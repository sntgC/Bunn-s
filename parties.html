<!DOCTYPE html>

<html lang="en">
<head>
	<meta charset="utf-8">

	<title>Bunn's: Burgers & Fun - Parties</title>
	<meta name="description" content="Bunn's: Burgers & Fun - Parties">
	<meta name="author" content="DemBois">
	<link href="https://fonts.googleapis.com/css?family=Open+Sans+Condensed:300" rel="stylesheet">
	<link href="https://fonts.googleapis.com/css?family=Averia+Sans+Libre" rel="stylesheet">
	<link href="https://fonts.googleapis.com/css?family=Skranji" rel="stylesheet">
	<link rel="stylesheet" href="libs/font-awesome-4.7.0/css/font-awesome.min.css">
	<link rel="stylesheet" href="css/style.css">
	<link rel="stylesheet" href="css/jquery-ui.css">
	<link rel="stylesheet" href="css/parties.css">
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.0/jquery.min.js"></script>
	<script src="libs/handlebars.min-latest.js"></script>
	<script src="js/animations.js"></script>
	<script src="js/objects.js"></script>
	<script src="js/jquery-ui.min.js"></script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/hammer.js/2.0.8/hammer.min.js"></script>
	<script src="libs/Handlebars.templates"></script>
	<script>
		var partyPackageTemplate;
		$(document).ready(function () {
			//Variables
			var slideCnts=[];
			var nameRoots=["Theme","Food","Cake"];

			//Template loading
			var source = $("#slideContainer-template").html();
			slideTemplate = Handlebars.compile(source);
			var pSource = $("#partyPackage-template").html();
			partyPackageTemplate = Handlebars.compile(pSource);
			for(t=0;t<nameRoots.length;t++){
				document.getElementById("party"+nameRoots[t]+"Container").innerHTML = slideTemplate(partyObj.sections[t]);
				setParagraphText(nameRoots[t].toLowerCase()+"DescriptionDisplay",partyObj.sections[t].options[0].description);
				slideCnts[t]=getSlideCount("party"+nameRoots[t]+"Container");
			}
			//Event binding
			function arrowHandler(root, direction, add, slideCount, func, index) {
				$("#" + root.toLowerCase() + "Arrow" + direction).on('click', function () {
					slideToDir("party" + root + "Container", direction.toLowerCase(), 400, loadPartyPackage);
					var slideIndex = (getSlideIndex("party" + root + "Container") + slideCount + add) % slideCount;
					func(slideIndex);
					setParagraphText(root.toLowerCase() + "DescriptionDisplay", partyObj.sections[index].options[slideIndex].description);
				});
			}
			for(t=0;t<nameRoots.length;t++){
				for(l=0;l<2;l++){
					var dir= (l==0? "Right":"Left");
					var add= (l==0? 1:-1);
					var themeBackgroundChange=function(sIndex){$('#themeRow').css({
						'background-image':"url("+partyObj.sections[0].options[sIndex].backgroundImage+")"
					});};
					if(t!=0)
						themeBackgroundChange=function(sIndex){};
					arrowHandler(nameRoots[t],dir,add,slideCnts[t],themeBackgroundChange, t);
				}
			}
			$(".partyBoxTiny").on('click',function (event) {
				$(event.target.parentNode.firstChild).toggleClass("selected");
				loadPartyPackage(getPartySelections);
			});
			$(".partyBoxTinyGoodies").on('click',function (event) {
				var divs = document.getElementsByClassName("partyBoxTinyGoodies");
				for (i = 0; i < divs.length; i++) {
					if ($(divs[i].firstChild).hasClass("selected"))
						$(divs[i].firstChild).toggleClass("selected");
				}
				$(event.target.parentNode.firstChild).toggleClass("selected");
				loadPartyPackage(getPartySelections);
			});

			//Creates jQuery UI Slider
			$(function () {
				$("#slider").slider({
					range: "min",
					value: 0,
					min: 0,
					max: 50,
					slide: function (event, ui) {
						document.getElementById("partyPackageGoodiesTicket").innerHTML=ui.value;
						document.getElementById("price").innerHTML=getPartySelections().price;
					}
				});
			});

			//Party Package Div Fixed on scroll
			function fixPartyPackage() {
				var currentScroll = $(window).scrollTop();
				if (currentScroll >= fixedPartyDisplayDivTop&&currentScroll+$("#partyPackage").height()<=footerDivTop-$("#headerWhite").height()) {
					$('#partyPackage').css({
						position: 'fixed',
						right: '-' + getScrollBarWidth() + 'px',
						width: '23vw',
						alignSelf:'auto'
					});
				} else if(currentScroll+$("#partyPackage").height() >footerDivTop-$("#headerWhite").height()){
					$('#partyPackage').css({
						position: 'static',
						right: '0px',
						alignSelf:'flex-end'
					});
				}else {
					$('#partyPackage').css({
						position: 'static',
						right: '0px',
						alignSelf:'flex-start'
					});
				}
			}
			$(window).scroll(fixPartyPackage);

			//Fixes resizing issue for fixed div
			var fixedPartyDisplayDivTop = $('#customPackageStart').offset().top - $("#headerWhite").height();
			var footerDivTop=$("#footer").offset().top;

			$(window).resize(function () {
				fixedPartyDisplayDivTop = $('#customPackageStart').offset().top - $("#headerWhite").height();
				footerDivTop=$("#footer").offset().top;
			});

			loadPartyPackage(getPartySelections);
			fixPartyPackage();
		});

		function loadPartyPackage(func){
			if(typeof func != 'undefined'){
				document.getElementById("partyPackageDisplay").innerHTML = partyPackageTemplate(func());
			}else{
				document.getElementById("partyPackageDisplay").innerHTML = partyPackageTemplate(getPartySelections());
			}
		}

		function getPartySelections(){
			var GPSSlides=document.getElementsByClassName("slideContainer");
			var GoodiesBoxes=document.getElementsByClassName("partyBoxTinyGoodies");
			var ActivitiesBoxes=document.getElementsByClassName("partyBoxTiny");
			var ret={};
			ret.price=0;
			ret.theme=partyObj.sections[0].options[getSlideIndex($(GPSSlides[0]).attr("id"))];
			ret.price+=ret.theme.price;
			
			var cakeString=document.getElementById("cakeName").value;
			var shortCakeString=cakeString.substring(0,cakeString.length<16? cakeString.length:16);
			if(cakeString.length>16)
				shortCakeString+="...";
			if(shortCakeString.length==0)
				shortCakeString="No Inscription";
			ret.food={lunch:partyObj.sections[1].options[getSlideIndex($(GPSSlides[1]).attr("id"))],
							cake:partyObj.sections[2].options[getSlideIndex($(GPSSlides[2]).attr("id"))],
							cakeName:cakeString,
							cakeNameShort:shortCakeString};
			ret.price+=ret.food.lunch.price+ret.food.cake.price;
			
			ret.activities={rowOne:[],rowTwo:[]};
			var g="";
			for(c=0;c<GoodiesBoxes.length;c++){
				if($(GoodiesBoxes[c]).children().first().hasClass("selected"))
					g=$(GoodiesBoxes[c]).attr("id").substring(7);
			}
			var goodiesIndex=["Small","Medium","Large"];
			var ticketCount=0;
			var ticketModifier=2;
			try{
				ticketCount=$("#slider").slider("option","value");
			}catch(e){
				console.log(e);
			}
			ret.price+=ticketCount*ticketModifier+partyObj.sections[3].options[goodiesIndex.indexOf(g)].price;
			ret.goodies={size:g,tickets:ticketCount};
			for(c=0;c<ActivitiesBoxes.length;c++){
				if($(ActivitiesBoxes[c]).children().first().hasClass("selected"))
					if(ret.activities.rowOne.length<=ret.activities.rowTwo.length)
						ret.activities.rowOne.push($(ActivitiesBoxes[c]).children().first().attr("src"));
					else
						ret.activities.rowTwo.push($(ActivitiesBoxes[c]).children().first().attr("src"));
			}
			ret.price+=(ret.activities.rowOne.length+ret.activities.rowTwo.length)*5;
			
			ret.activities.drawOne=ret.activities.rowOne.length>0;
			ret.activities.drawTwo=ret.activities.rowTwo.length>0;
			
			ret.price=Math.ceil(ret.price/5)*5;
			return ret;
		}

	</script>
	<script id="slideContainer-template" type="text/x-handlebars-template">
		{{#each options}}
		<div class="slide">
		<img src='{{image}}'>
		</div>
		{{/each}}
	</script>
	<script id="partyPackage-template" type="text/x-handlebars-template">
		<div class="flexItem partyPackageFlexRow" id="partyPackageTheme">
		<div id="partyPackageThemeName" class="partyPackageColorBlue center">{{theme.name}}</div>
		<div id="partyPackageThemePic" class="growOne partyPackageColorBlue partyPackageImage" style="background-image: url({{theme.image}})"></div>
		</div>
		<div class="flexItem partyPackageFlexRow" id="partyPackageFood">
			<div id="partyPackageLunch" class="growOne partyPackageColorBlue partyPackageImage" style="background-image: url({{food.lunch.image}})"></div>
			<div id="partyPackageCake" class="growOne">
				<div id="partyPackageCakePic" class="partyPackageColorBlue partyPackageImage" style="background-image: url({{food.cake.image}})"></div>
				<div id="partyPackageCakeInsc" class="growOne partyPackageColorBlue center">{{food.cakeNameShort}}</div>
			</div>
		</div>
		<div class="flexItem partyPackageFlexRow" id="partyPackageGoodies">
			<div id="partyPackageGoodiesTicket" class="growOne partyPackageColorBlue center">{{goodies.tickets}}</div>
			<div id="partyPackageGoodiesDesc" class="partyPackageColorBlue center">{{goodies.size}}</div>
		</div>
			{{#if activities.drawOne}}
				<div class="flexItem" id="partyPackageActivities">
					<div class="partyPackageActRow growOne center">
					{{#each activities.rowOne}}
					<div class="partyPackageActItem growOne center partyPackageImage" style="background-image: url({{this}})"></div>
					{{/each}}
					</div>
					{{#if activities.drawTwo}}
					<div class="partyPackageActRow growOne center">
					{{#each activities.rowTwo}}
					<div class="partyPackageActItem growOne center partyPackageImage" style="background-image: url({{this}})"></div>
					{{/each}}
					</div>
					{{/if}}
				</div>
			{{/if}}
		<div class="flexItem partyPackageFlexRow" id="partyPackageInfo">
			<div id="price" class="partyPackageInfoItem partyPackageColorBlue center">${{price}}</div>
			<div id="date" class="partyPackageInfoItem partyPackageColorBlue center">Date</div>
		</div>
	</script>
</head>

<body class="noSelect">
	<div id="headerWhite" style="font-size:16px">
			<div class="headerHalf">
				<li class="navTitle colorRed"><a href="rewards" class="makeYellow">REWARDS</a></li>
				<li class="navTitle colorBlue underline makeYellow">PARTIES</li>
				<li class="navTitle colorYellow"><a href="menu" class="makeYellow">FOOD</a></li>
				<li class="navTitle colorPurple"><a href="activities" class="makeYellow">ACTIVITIES</a></li>
			</div>
			<div class="headerHalf"  id="headerHalfFirst">
				<li class="navTitle logoClear" style="float:left"  id="headerLogo"><a href="index" class="makeYellow">BUNN'S</a></li>
			</div>
	</div>
	<div class="background" style="background-image: url(assets/party.jpg)">

	</div>
	<div id="focus" style="position:fixed;left:0px;width:20vw;height:20vh;background:white;z-index:200;top:80vh;text-align:center;font-size:2vh;box-shadow: 40px -19px 30px -12px rgba(0,0,0,0.4);visibility:hidden;">
	<a href="javascript:document.getElementById('focus').remove()"><div style="position:absolute;right:.5vw;top:.5vh;color:black;">X</div></a>
	<p>Welcome to the Bunn's focus group!</p>
	<p>Please take a moment to browse this page and answer <a target="_blank" style="color:red" href="https://drive.google.com/open?id=1QGG8ydR0VHJBeRcQVMaR9wp1EvC1u0q7surxz7Ul0ew">this</a> survey when you are finished. Please stay only on this page.</p>
	<p>If you close this dialog, refresh to get it back</p>
	</div>
	<div id="partyContentContainer">
	<div id="customPackageStart">
			<div class="partyRow" id="themeRow">
				<div class="tooltip">?<span class="tooltipContent textTiny">Themes give your party a fun spin. Every plate, cup, and invitation will be designed to adapt to the theme, and you'll even get a special keepsake.</span></div>
				<div class="partyContainer">
					<p class="textEmphasized"><span class="textUnderlined">Themes</span></p>
					<p>Dozens of themes to select from!</p>
					<div class="partyBoxContainer">
					<div class="partyBoxThin">
						<div class="partyArrowLeft" id="themeArrowLeft">
						</div>
					</div>
					<div class="partyBoxSmall">
						<div class="slideContainer" id="partyThemeContainer"></div>
					</div>
					<div class="partyBoxThin">
						<div class="partyArrowRight" id="themeArrowRight">
						</div>
					</div>
					</div>
					<p id="themeDescriptionDisplay">Theme description here</p>
				</div>
			</div>
			<div class="partyRow" id="foodRow">
				<div class="foodContainer" id="lunchContainer">
				<div class="tooltip">?<span class="tooltipContent textTiny">Lunch packages give you a general idea of what your guests will eat. However, each guest gets to have some choice in their food without any additional cost.</span></div>
				<div class="partyContainer">
					<p  class="textEmphasized"><span class="textUnderlined">Food</span></p>
					<p>Food for fun!</p>
					<div class="partyBoxContainer">
					<div class="partyBoxThin">
						<div class="partyArrowLeft" id="foodArrowLeft">
						</div>
					</div>
					<div class="partyBoxSmall">
						<div class="slideContainer" id="partyFoodContainer"></div>
					</div>
					<div class="partyBoxThin">
						<div class="partyArrowRight" id="foodArrowRight">
						</div>
					</div>
					</div>
					<p id="foodDescriptionDisplay">Food description here</p>
				</div>
				</div>
				<div class="foodContainer">
				<div class="tooltip">?<span class="tooltipContent textTiny">Choose from a variety of cake options. You can also choose to add an inscription on the cake if you wish.</span></div>
				<div class="partyContainer">
					<p  class="textEmphasized"><span class="textUnderlined">Cake</span></p>
					<p>Let them eat cake!</p>
					<div class="partyBoxContainer">
					<div class="partyBoxThin">
						<div class="partyArrowLeft" id="cakeArrowLeft">
						</div>
					</div>
					<div class="partyBoxSmall">
						<div class="slideContainer" id="partyCakeContainer"></div>
					</div>
					<div class="partyBoxThin">
						<div class="partyArrowRight" id="cakeArrowRight">
						</div>
					</div>
					</div>
					<p id="cakeDescriptionDisplay">Cake description here</p>
					<p>Include an inscription: <br><input type="text" id="cakeName" oninput="loadPartyPackage()"></p>
				</div>
				</div>
			</div>
			<div class="partyRow" id="goodiesRow">
				<div class="tooltip">?<span class="tooltipContent textTiny">Each increasing size of goodie bags contains the contents of the previous size with some additional treats. <br><i>Hover over each package to see its details.</i><br><br>Tokens are used to operate the arcade games.</span></div>
				<div class="partyContainer">
					<p  class="textEmphasized"><span class="textUnderlined">Goodies</span></p>
					<p>Give them something to remember!</p>
					<div>
					<div class="partyBoxTinyGoodies" id="goodiesSmall"><img draggable=false src="assets/bag1.jpg"><h2 class="noSelect">Small</h2></div>
					<div class="partyBoxTinyGoodies" id="goodiesMedium"><img draggable=false src="assets/bag2.jpg" class="selected"><h2 class="noSelect">Medium</h2></div>
					<div class="partyBoxTinyGoodies" id="goodiesLarge"><img draggable=false src="assets/bag3.jpg"><h2 class="noSelect">Large</h2></div>
					</div>
					<div id="sliderContainer">
					<p  class="textSmall">Move the slider to change the amount of tokens received per child.</p>
					<div>
					<div id="slider"></div>
					</div>
					</div>
				</div>
			</div>
			<div class="partyRow" id="activitiesRow">
				<div class="tooltip">?<span class="tooltipContent textTiny">The activities you select will be reserved for your party. However, if you choose not to reserve, you can still enjoy them if they are available.</span></div>
				<div class="partyContainer">
					<p  class="textEmphasized"><span class="textUnderlined">Activities</span></p>
					<p >Keep them entertained!</p>
					<div id="activityContainer">
					<div class="partyBoxTiny"><img draggable=false src="assets/poolActivityIcon.jpg"> <h2 class="noSelect">Pool</h2></div>
					<div class="partyBoxTiny"><img draggable=false src="assets/bowlingActivityIcon.jpg"><h2 class="noSelect">Bowling</h2></div>
					<div class="partyBoxTiny"><img draggable=false src="assets/arcadeActivityIcon.jpg"><h2 class="noSelect">Arcade</h2></div>
					<div class="partyBoxTiny"><img draggable=false src="assets/airhockeyActivityIcon.jpg"><h2 class="noSelect">Air Hockey</h2></div>
					<div class="partyBoxTiny"><img draggable=false src="assets/pingpongActivityIcon.jpg"><h2 class="noSelect">Ping Pong</h2></div>
					<div class="partyBoxTiny"><img draggable=false src="assets/vrActivityIcon.jpg"><h2 class="noSelect">Virtual Reality</h2></div>
					<div class="partyBoxTiny"><img draggable=false src="assets/lasertagActivityIcon.jpg"><h2 class="noSelect">Laser Tag</h2></div>
					<div class="partyBoxTiny"><img draggable=false src="assets/playgroundActivityIcon.jpg"><h2 class="noSelect">Jungle Gym</h2></div>
					</div>
				</div>
			</div>
	</div>
	<div id="partySidebar">
		<div id="partyPackage">
			<p class="textEmphasized"><span class="textUnderlined">Your Party</span></p>
			<div id="partyPackageDisplay">
			</div>
		</div>
	</div>
	</div>
	<div id="footer"></div>
</body>
</html>
